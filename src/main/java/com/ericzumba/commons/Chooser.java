package com.ericzumba.commons;

import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;
import java.util.function.Function;

/*
 * This Java source file was auto generated by running 'gradle buildInit --type java-library'
 * by 'ericzumba' at '11/10/16 12:13 AM' with Gradle 3.1
 *
 * @author ericzumba, @date 11/10/16 12:13 AM
 */
public class Chooser<T, R> {
    public final Function<T, R> firstChoice;
    public final Function<T, R> alternative;
    public Map<T, Function<T, R>> knowledge = new ConcurrentHashMap<>();
    private Function<R, Function<T, R>> rule;

    public Chooser(Function<T, R> firstChoice, Function<T, R> alternative) {
        this.firstChoice = firstChoice;
        this.alternative = alternative;
    }

    public Chooser<T, R> installRule(Function<R, Function<T, R>> rule) {
        this.rule = rule;
        return this;
    }

    public R choose(T t) {
        Function<T, R> choice = knowledge.get(t);
        if(choice == null)
            return register(t, firstChoice.apply(t));
        return register(t, choice.apply(t));
    }

    private R register(T t, R r) {
        knowledge.put(t, rule.apply(r));
        return r;
    }
}
